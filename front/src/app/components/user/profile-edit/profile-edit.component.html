<div class="flex justify-center items-center min-h-screen bg-gray-100 p-5">
  <div class="bg-white rounded-lg shadow-lg w-full max-w-md p-8 relative">
    <div *ngIf="isLoading" class="flex justify-center items-center min-h-[200px]">
      <div class="w-10 h-10 border-4 border-gray-200 border-t-blue-600 rounded-full animate-spin"></div>
    </div>
    
    <div *ngIf="errorMessage" class="text-red-600 text-center p-4 bg-red-50 rounded-lg mb-5">
      {{ errorMessage }}
    </div>
    
    <div *ngIf="successMessage" class="text-green-600 text-center p-4 bg-green-50 rounded-lg mb-5">
      {{ successMessage }}
    </div>
    
    <div *ngIf="currentUser && !isLoading">
      <h1 class="text-gray-800 text-2xl mb-8 text-center font-semibold">Edit Profile</h1>
      
      <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="mt-5">
        <div class="mb-5">
          <label for="username" class="block mb-2 font-medium text-gray-600">Username</label>
          <input 
            type="text" 
            id="username" 
            formControlName="username" 
            class="w-full p-3 border rounded text-base transition-colors focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-200"
            [ngClass]="{'border-red-500': isSubmitted && profileForm.controls['username'].errors, 'border-gray-300': !isSubmitted || !profileForm.controls['username'].errors}"
          >
          <div *ngIf="isSubmitted && profileForm.controls['username'].errors" class="text-red-600 text-sm mt-1">
            <div *ngIf="profileForm.controls['username'].errors['required']">Username is required</div>
            <div *ngIf="profileForm.controls['username'].errors['minlength']">Username must be at least 3 characters</div>
            <div *ngIf="profileForm.controls['username'].errors['maxlength']">Username cannot exceed 20 characters</div>
          </div>
        </div>
        
        <div class="mb-5">
          <label for="email" class="block mb-2 font-medium text-gray-600">Email</label>
          <input 
            type="email" 
            id="email" 
            formControlName="email" 
            class="w-full p-3 border rounded text-base transition-colors focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-200"
            [ngClass]="{'border-red-500': isSubmitted && profileForm.controls['email'].errors, 'border-gray-300': !isSubmitted || !profileForm.controls['email'].errors}"
          >
          <div *ngIf="isSubmitted && profileForm.controls['email'].errors" class="text-red-600 text-sm mt-1">
            <div *ngIf="profileForm.controls['email'].errors['required']">Email is required</div>
            <div *ngIf="profileForm.controls['email'].errors['email']">Please enter a valid email address</div>
          </div>
        </div>
        
        <div class="mb-5">
          <label for="currentPassword" class="block mb-2 font-medium text-gray-600">Current Password</label>
          <input 
            type="password" 
            id="currentPassword" 
            formControlName="currentPassword" 
            class="w-full p-3 border rounded text-base transition-colors focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-200"
            [ngClass]="{'border-red-500': isSubmitted && profileForm.controls['currentPassword'].errors, 'border-gray-300': !isSubmitted || !profileForm.controls['currentPassword'].errors}"
          >
          <div *ngIf="isSubmitted && profileForm.controls['currentPassword'].errors" class="text-red-600 text-sm mt-1">
            <div *ngIf="profileForm.controls['currentPassword'].errors['required']">Current password is required</div>
          </div>
        </div>
        
        <div class="mb-5">
          <label for="newPassword" class="block mb-2 font-medium text-gray-600">New Password (optional)</label>
          <input 
            type="password" 
            id="newPassword" 
            formControlName="newPassword" 
            class="w-full p-3 border rounded text-base transition-colors focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-200"
            [ngClass]="{'border-red-500': isSubmitted && profileForm.controls['newPassword'].errors, 'border-gray-300': !isSubmitted || !profileForm.controls['newPassword'].errors}"
          >
          <div *ngIf="isSubmitted && profileForm.controls['newPassword'].errors" class="text-red-600 text-sm mt-1">
            <div *ngIf="profileForm.controls['newPassword'].errors['pattern']">
              Password must be at least 8 characters and include uppercase, lowercase, number, and special character
            </div>
          </div>
        </div>
        
        <div class="mb-5">
          <label for="confirmPassword" class="block mb-2 font-medium text-gray-600">Confirm New Password</label>
          <input 
            type="password" 
            id="confirmPassword" 
            formControlName="confirmPassword" 
            class="w-full p-3 border rounded text-base transition-colors focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-200"
            [ngClass]="{'border-red-500': isSubmitted && profileForm.controls['confirmPassword'].errors, 'border-gray-300': !isSubmitted || !profileForm.controls['confirmPassword'].errors}"
          >
          <div *ngIf="isSubmitted && profileForm.controls['confirmPassword'].errors" class="text-red-600 text-sm mt-1">
            <div *ngIf="profileForm.controls['confirmPassword'].errors['mismatch']">Passwords do not match</div>
          </div>
        </div>
        
        <div class="flex justify-between mt-8 gap-3 sm:flex-row flex-col-reverse">
          <button type="button" class="bg-gray-100 hover:bg-gray-200 text-gray-600 px-6 py-3 rounded font-semibold cursor-pointer transition-all duration-300 border-0" (click)="cancel()">Cancel</button>
          <button type="submit" class="bg-blue-600 hover:bg-blue-700 disabled:bg-blue-300 disabled:cursor-not-allowed text-white px-6 py-3 rounded font-semibold cursor-pointer transition-all duration-300 border-0" [disabled]="isLoading">
            <span *ngIf="isLoading">Saving...</span>
            <span *ngIf="!isLoading">Save Changes</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="max-w-4xl mx-auto p-5">
  <!-- Header with back arrow and title -->
  <div class="flex items-center mb-8">
    <button 
      class="flex items-center text-gray-600 hover:text-gray-800 mr-4"
      (click)="goBack()">
      <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
    </button>
    <h1 class="text-2xl font-bold text-gray-800">Profil utilisateur</h1>
  </div>

  <!-- Profile form -->
  <div class="max-w-md mx-auto">
    <!-- Loading Profile -->
    <div *ngIf="isLoadingProfile" class="flex justify-center items-center py-8">
      <div class="w-8 h-8 border-4 border-gray-200 border-t-purple-600 rounded-full animate-spin"></div>
    </div>
    
    <!-- Error Message -->
    <div *ngIf="errorMessage" class="p-3 rounded-lg mb-6 bg-red-100 text-red-800 border border-red-200">
      {{ errorMessage }}
    </div>
    
    <!-- Success Message -->
    <div *ngIf="successMessage" class="p-3 rounded-lg mb-6 bg-green-100 text-green-800 border border-green-200">
      {{ successMessage }}
    </div>
    
    <form *ngIf="!isLoadingProfile" [formGroup]="profileForm" (ngSubmit)="onSubmit()">
      <!-- Username Field -->
      <div class="mb-6">
        <input 
          type="text" 
          formControlName="username"
          placeholder="Username"
          class="w-full p-3 border border-purple-300 rounded-lg text-base bg-white box-border focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200"
          [ngClass]="{ 'border-red-500': getFieldError('username') }"
        >
        <div *ngIf="getFieldError('username')" class="text-red-500 text-sm mt-1">
          {{ getFieldError('username') }}
        </div>
      </div>
      
      <!-- Email Field -->
      <div class="mb-6">
        <input 
          type="email" 
          formControlName="email"
          placeholder="email@email.fr"
          class="w-full p-3 border border-purple-300 rounded-lg text-base bg-white box-border focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200"
          [ngClass]="{ 'border-red-500': getFieldError('email') }"
        >
        <div *ngIf="getFieldError('email')" class="text-red-500 text-sm mt-1">
          {{ getFieldError('email') }}
        </div>
      </div>
      
      <!-- Password Field -->
      <div class="mb-6">
        <input 
          type="password" 
          formControlName="password"
          placeholder="Mot de passe"
          class="w-full p-3 border border-purple-300 rounded-lg text-base bg-white box-border focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200"
          [ngClass]="{ 'border-red-500': getFieldError('password') }"
        >
        <div *ngIf="getFieldError('password')" class="text-red-500 text-sm mt-1">
          {{ getFieldError('password') }}
        </div>
        <div class="mt-1 text-gray-500 text-xs">
          Laissez vide pour conserver le mot de passe actuel
        </div>
      </div>
      
      <!-- Submit Button -->
      <div class="text-center">
        <button 
          type="submit" 
          [disabled]="isSubmitting"
          class="bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium px-8 py-3 rounded-lg transition-colors duration-200"
        >
          <span *ngIf="isSubmitting" class="inline-block w-4 h-4 border-2 border-current border-r-transparent rounded-full animate-spin mr-2" role="status" aria-hidden="true"></span>
          Sauvegarder
        </button>
      </div>
    </form>
  </div>
  
  <!-- Subscriptions Section -->
  <div class="max-w-4xl mx-auto mt-12">
    <h2 class="text-2xl font-bold text-gray-800 mb-8">Abonnements</h2>
    
    <!-- Loading Subscriptions -->
    <div *ngIf="isLoadingSubscriptions" class="flex justify-center items-center py-8">
      <div class="w-8 h-8 border-4 border-gray-200 border-t-purple-600 rounded-full animate-spin"></div>
    </div>
    
    <!-- No Subscriptions -->
    <div *ngIf="!isLoadingSubscriptions && subscriptions.length === 0" class="text-center py-8 text-gray-500">
      Vous n'êtes abonné à aucun thème pour le moment.
    </div>
    
    <!-- Subscriptions Grid -->
    <div *ngIf="!isLoadingSubscriptions && subscriptions.length > 0" class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <app-topic-item 
        *ngFor="let subscription of subscriptions" 
        [topic]="subscription"
        [mode]="'unsubscribe'"
        (unsubscribe)="unsubscribeFromTopic($event)">
      </app-topic-item>
    </div>
  </div>
</div>